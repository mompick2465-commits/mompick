"use strict";(self.webpackChunkmompick=self.webpackChunkmompick||[]).push([[878],{878:(t,a,e)=>{e.d(a,{childcareDetailCacheManager:()=>s});var o=e(801);const s=new class{constructor(){this.supabase=o.supabase,this.bucketName="childcare-detail-cache",this.cacheExpiryDays=7}detailPath(t){return"details/".concat(t,"/latest.json")}snapshotPath(t,a){return"details/".concat(t,"/").concat(a,".json")}async getCachedDetail(t){try{const a="details/".concat(t),{data:e,error:o}=await this.supabase.storage.from(this.bucketName).list(a);if(o||!e||0===e.length)return console.log("\ud83d\udcc1 Storage\uc5d0 \uc5b4\ub9b0\uc774\uc9d1 \uc0c1\uc138 \uce90\uc2dc \uc5c6\uc74c: ".concat(t)),null;const s=e.find(t=>"latest.json"===t.name);if(!s)return console.log("\ud83d\udcc1 Storage\uc5d0 \uc5b4\ub9b0\uc774\uc9d1 \uc0c1\uc138 \uce90\uc2dc \uc5c6\uc74c: ".concat(t)),null;const n=new Date(s.updated_at).getTime(),c=(Date.now()-n)/864e5;if(c>this.cacheExpiryDays)return console.log("\u23f0 \ud30c\uc77c \uba54\ud0c0\ub370\uc774\ud130 \uae30\uc900 \uc5b4\ub9b0\uc774\uc9d1 \uce90\uc2dc \ub9cc\ub8cc: ".concat(t," (").concat(c.toFixed(1),"\uc77c \uacbd\uacfc)")),null;console.log("\ud83d\udcc4 \uc5b4\ub9b0\uc774\uc9d1 latest.json \ub2e4\uc6b4\ub85c\ub4dc: ".concat(t," (").concat(c.toFixed(1),"\uc77c \uc804)"));const i=this.detailPath(t),{data:r,error:l}=await this.supabase.storage.from(this.bucketName).download(i);if(l||!r)return null;const u=await r.text(),h=JSON.parse(u);return console.log("\u2705 \uc5b4\ub9b0\uc774\uc9d1 \uc0c1\uc138 \uce90\uc2dc \uc0ac\uc6a9: ".concat(t," (").concat(c.toFixed(1),"\uc77c \uc804)")),h.data}catch(a){return console.warn("\uc5b4\ub9b0\uc774\uc9d1 \uc0c1\uc138 \uce90\uc2dc \uc870\ud68c \uc624\ub958:",a),null}}async saveDetailCache(t,a){try{const o=new Date,s=o.toISOString().split("T")[0],n={meta:{stcode:t,lastSyncedAt:o.toISOString(),apiVersion:"1.0"},data:a},c=this.detailPath(t),i=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),r=async t=>{const a=this.supabase.storage.from(this.bucketName).upload(t,i,{cacheControl:"3600",upsert:!0}),e=new Promise((t,a)=>{setTimeout(()=>a(new Error("timeout")),5e3)}),{error:o}=await Promise.race([a,e]);if(o)throw o};try{await r(c)}catch(e){const a=((null===e||void 0===e?void 0:e.message)||"").toString();return"504"===((null===e||void 0===e?void 0:e.status)||(null===e||void 0===e?void 0:e.code)||"").toString()||a.includes("504")||a.toLowerCase().includes("timeout")?void console.warn("\uc5b4\ub9b0\uc774\uc9d1 latest \uce90\uc2dc \uc800\uc7a5 \ud0c0\uc784\uc544\uc6c3(\ubb34\uc2dc):",t):void console.warn("\uc5b4\ub9b0\uc774\uc9d1 latest \uce90\uc2dc \uc800\uc7a5 \uc624\ub958(\ubb34\uc2dc):",e)}const l=this.snapshotPath(t,s);try{await r(l)}catch(e){console.warn("\uc5b4\ub9b0\uc774\uc9d1 \uc2a4\ub0c5\uc0f7 \uce90\uc2dc \uc800\uc7a5 \uc2e4\ud328(\ubb34\uc2dc):",e)}console.log("\ud83d\udcbe \uc5b4\ub9b0\uc774\uc9d1 \uc0c1\uc138 \uce90\uc2dc \uc800\uc7a5: ".concat(t))}catch(e){console.warn("\uc5b4\ub9b0\uc774\uc9d1 \uc0c1\uc138 \uce90\uc2dc \uc800\uc7a5 \uc624\ub958:",e)}}}}}]);
//# sourceMappingURL=878.34ccfcfd.chunk.js.map